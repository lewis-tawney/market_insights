---
globs: engine/**/*.py,tools/**/*.py
description: Data processing and financial analysis guidelines
---

# Data Processing Rules

## Financial Data Standards
- Use consistent date formats (YYYY-MM-DD)
- Normalize symbol names (uppercase, strip suffixes)
- Handle missing data appropriately
- Implement proper data validation

## Data Processing Pipeline
- **Ingestion**: Load raw data from providers
- **Normalization**: Standardize formats and symbols
- **Feature Engineering**: Calculate technical indicators
- **Aggregation**: Create breadth metrics
- **Storage**: Save as Parquet files with partitioning

## Key Processing Modules
- [engine/providers/](mdc:engine/providers/) - Data source providers
- [engine/jobs/](mdc:engine/jobs/) - Data processing jobs
- [engine/out/](mdc:engine/out/) - Processed data outputs
- [tools/](mdc:tools/) - Utility scripts

## Data Storage Guidelines
- Use Parquet format for processed data
- Partition by date for efficient querying
- Implement incremental processing
- Maintain data lineage and metadata

## Financial Calculations
- Implement forward-safe calculations (no look-ahead bias)
- Use proper window functions for rolling calculations
- Handle corporate actions and splits
- Validate calculation results

## Performance Optimization
- Use vectorized operations with pandas/numpy
- Implement lazy loading for large datasets
- Cache frequently accessed data
- Use appropriate data types to reduce memory usage

## Error Handling
- Validate data quality before processing
- Handle missing or corrupted data gracefully
- Implement proper logging for data issues
- Create data quality reports
